---
layout : post
title : 2017년 10월 11일 TIL
---

# 네트워크

## NAT(Network Address Translation)
여러 사람이 같은 주소를 사용하게 함으로써 IP 주소 부족을 해결한다. 
같은 네트워크 내부에서는 유일한 IP를 사용하지만 외부에서는 중복된 IP가 있을 수 있다.

### 게이트웨어 라우터
Souce의 IP를 public IP로 바꾸어 준다. 외부에서 들어 오는 것도 변환해 준다.

### 문제점 
디자인 상의 문제 : 레이어 디자인이 무너진다. 상위 계층의 정보(포트)를 바꾸어 버린다. 
현실 적인 문제 : NAT에서 포트가 변환되기 때문에 NAT설정이 없으면 원하는 연결이 불가능하다.

### IPv4에서 고려되지 않은 것 
1. 주소의 추가 
2. 보안  
- 대안 : IPv6(나온지 20년 넘음)으로 전환 혹은 새로운 인터넷 프로토콜
- IPv4를 사용하면서 얻은 문제 : 미래에 어떤 요구 사항이 생길지 예측할 수 없다. 한번 프로토콜이 결정되면 바꾸기가 힘들다.

### NAT 밖으로 나가는 ip는 유일한 ip인가?
아니다. 밖도 NAT로 묶여 있을 수 있기 때문이다.

## DHCP(Dynamic Host Configuration Protocol)
ipconfig에서 얻을 수 있는 정보가 다음과 같다면
시스템 환경설정/네트워크/연결된 이더넷 선택/고급
```
IP      192 168.1.22
mask    255.255.255.0
router  192.168.1.1
DNS     192.168.1.1
```
서브넷은 192.168.1.0이다. 라우터와 local DNS는 같다.

이런 주소를 자동적으로 잡아주는 것을 DHCP라고 한다.
고정된 ip(static ip)를 사용하기 위해서는 설정을 바꿔야 한다.
모든 ip를 고정 ip로 사용하면 손해를 본다. 학교에서 사용한다면 10000개 정도 필요 하다. 하지만 DHCP를 사용한다면 지금 활성화된 장비의 ip만 있으면 된다. DHCP는 시간을 정해서 ip를 제공하고 회수한다.

### DHCP 동작
사용자는 ip에 대해서 알지 못해도 인터넷을 사용 할수 있다.
- DHCP discover message : 처음 접속한 장비는 주변에게 도움을 청한다. 브로드 캐스트로 보냄 DHCP 서버를 제외한 다른 장비는 discover메세지를 무시한다. 포트번호를 67번호로 해서 DHCP서버만 받는다.
- DHCP offer : DHCP서버에서 주소 할당 정보를 브로드 캐스트로 보낸다. 
- DHCP request : 장비는 주소가 사용할수 있으면 request를 보낸다.
- DHCP ACK

보통은 게이트웨이 라우터에 로컬 DNS와 DHCP서버가 같이 동작한다.

## 브로드 캐스트
목적지 주소가 1이면 브로드 캐스트 이다. 서브넷에 있는 모든 장비는 브로드 캐스트 메시지를 받는다.

## IP 프레그멘테이션, 리셈블리
MTU - 링크레이어의 HW마다 다름
MTU를 넘으면 독립적인 사이즈의 프레임으로 분해되어서 이후에 다시 합쳐짐 
```
ex) 4000byte의 패킷, 링크의 MTU는 1500byte인 경우
패킷의 헤더는 20바이트이다.이를 고려해서 분해된다.
20바이트 헤더(length = 1500 fragflag = 1 offset = 0) +  1480바이트의 데이터
20바이트 헤더(fragflag = 1 offset = 185(비트수를 줄이기 위해서 8로 나누어준다.)) + 1480바이트의 데이터
20바이트 헤더(fragflag = 0 offset = 370) + 나머지 데이터 (1040바이트)
```
중간에 분해된 패킷이 사라진다면? 리어셈블리가 안되고 재전송됨(타이머 타임아웃등에 의해서)

## ICMP
라우터에서 데스트네이션에 해당하는 포트가 없으면 드랍, TTL이 지나면 드랍 이런 경우 Source에 리포트가 피룡하다. 이런 컨트롤 메시지를 전송하기 위한 프로토콜이다.
네트워크 진단을 위해서 사용한다.  
traceroute - 라우트 경로를 추적하는 유틸리티 ICMP를 이용함

## 터널링
과도기에는 IPv4와 IPv6 라우터가 혼재되어 있을 수 있다., IPv4는 v6해석 못함 이를 위해서 v6은 데이터에 넣어 주고 IPv4가 이해 할수 있는 주소로 바꾸어 준다.

## 라우팅 알고리즘
포워딩 테이블 Lookup - longest matching
라우팅 알고리즘으로 포워딩 테이블을 채운다.
가장 좋은 경로로 포워딩 테이블을 만든다. 이를 위해서 Graph로 추상화 한다. 결과적으로 최단 거리 구하는 알고리즘이 된다.
- 노드 : 라우터
- 에지 : 비용
1. 전체 네트워크를 구조를 알고 있는 경우 - 링크 상태
2. 주변의 비용만 알고 있는 경우 - 거리 벡터

### 링크 스테이트 알고리즘
모든 라우터들이 자신의 정보를 브로트 캐스트 해야한다. 전체 네트워크를 알게되면 -> 다익스트라 알고리즘 -> 테이블 생성
한점의 포워딩 테이블의 엔트리를 채우는 것이 목표이다.

#### 전세계의 라우터의 거리를 다 알아야 하는가?
현실적으로는 브로드 캐스트의 범위가 정해져 있다.
관리 주체가 동일한(같은 도메인) 네트워크끼리만 적용한다. (A학교꺼 B학교꺼 C회사꺼 따로)

#### 네트워크끼리의 라우팅은?
거리 백터 알고리즘 사용 

# 알고리즘
goorm.io에서 모의고사를 봤다. 확실하게 내 문제점을 찾아 냈다. 처음에는 설계를 해보고 하지만, 급해지면 키보드 부터 만지고 있다. 자료구조랑 문제 해결 방식을 완전히 하고 코드 작성으로 가는 연습이 필요하다.

